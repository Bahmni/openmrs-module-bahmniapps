<section class="block observation" ng-if="visit.hasObservations()">
    <h2 class="section-title">Observations</h2>
    <ul bm-gallery patient="patient" access-impression="true">
        <div ng-repeat="observationGroup in visit.observationGroups">
            <table>
                <thead ng-click="visit.expandOrCollapse(observationGroup)">
                    <tr class="headerRow row-click">
                        <th colspan="3">
                            <i class="icon-caret-right" ng-hide="observationGroup.isOpen"></i>
                            <i class="icon-caret-down" ng-show="observationGroup.isOpen"></i>
                            <span class="date">{{observationGroup.date | date :'dd MMM yy'}}</span>
                        </th>
                    </tr>
                </thead>
                <tbody ng-repeat="observationSubGroup in observationGroup.subGroups" ng-show="observationGroup.isOpen">

                    <tr >
                        <td colspan="3">
                            <span class="obs-value">{{observationSubGroup.conceptName}}</span>
                        </td>
                    </tr>


                    <tr class="row-click" toggle="observation.showComment"
                        ng-repeat-start="observation in observationSubGroup.obs"
                        ng-class="{true: 'is-abnormal'}[observation.abnormalObs.value]">
                        <td class="name">
                            <span class="obs-value">{{observation.label}}</span>
                        </td>
                        <td class="value has-toggle-btn" data-ng-switch="observation.concept.conceptClass">
                            <img data-ng-switch-when="Image"
                                 bm-observation-gallery-item observation="observation"
                                 ng-src="{{observation.value|thumbnail}}" width="100">
                            <span data-ng-switch-default class="obs-value"><pre class="chief-notes">{{observation | observationValue}} {{observation.concept.units}}</pre></span>
                        </td>
                        <td class="toggle-btn">
                            <button class="toggle fr" ng-class="{'has-notes': observation.comment}">
                                <i class="icon-plus-sign" ng-hide="observation.showComment"></i>
                                <i class="icon-minus-sign" ng-show="observation.showComment"></i>
                            </button>
                        </td>
                    </tr>
                    <tr ng-repeat-end>
                        <td class="notes inline-notes" colspan="3" ng-class="{'print-notes': observation.comment}"
                            ng-show="observation.showComment">
                            <pre class="left">{{observation.comment}}</pre>
                            <div class="footer-note fr">
                                        <span class="time-stamp">
                                            <span class="time">{{observation.observationDateTime | date :'hh:mm a'}}</span>
                                        </span>
                                <span class="provider" bindonce="observation" bo-text="observation.provider.name"></span>
                            </div>
                        </td>
                    </tr>

                </tbody>
            </table>
        </div>
    </ul>
</section>
